:root{
  --bg:#0b1020;
  --card:#121a33;
  --card2:#0f1730;
  --text:#e8ecff;
  --muted:#9aa6d6;
  --border:rgba(255,255,255,.08);
  --primary:#6ea8fe;
  --danger:#ff6b6b;
  --good:#46d39a;
  --warn:#ffcc66;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: radial-gradient(1200px 800px at 20% 10%, rgba(110,168,254,.25), transparent 60%), var(--bg);
  color:var(--text);
}

.app{min-height:100%; display:flex; flex-direction:column}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  background: rgba(18,26,51,.7);
  backdrop-filter: blur(10px);
}
.brand{font-weight:700; letter-spacing:.4px}
.topbar-actions{display:flex; gap:10px; align-items:center}

.qa-timer{
  font-variant-numeric: tabular-nums;
  font-size:12px;
  color:var(--muted);
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:10px;
  background: rgba(15,23,48,.6);
  white-space:nowrap;
}

#qaTimer{
  position: fixed !important;
  top: 12px !important;
  left: 12px !important;
  right: auto !important;
  z-index: 9999 !important;
  font-size: 20px !important;
  padding: 12px 16px !important;
  border-radius: 14px !important;
  background: rgba(15,23,48,.92) !important;
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 36px rgba(0,0,0,.45);
  border-color: rgba(110,168,254,.28);
}
.qa-timer.qa-timer-warn{
  color: var(--danger);
  border-color: rgba(255,107,107,.45);
  background: rgba(255,107,107,.10);
}

.qa-timer-inline{
  margin-top:6px;
  width: fit-content;
}

.layout{flex:1; display:grid; grid-template-columns: 360px 1fr; gap:14px; padding:14px}

.sidebar{
  border:1px solid var(--border);
  background: rgba(18,26,51,.6);
  border-radius:14px;
  padding:12px;
  overflow:auto;
}

.content{display:flex; flex-direction:column; gap:14px}

.qa-recite-wrap{display:flex; flex-direction:column; gap:14px}
.qa-recite-wrap.is-side-by-side{display:grid; grid-template-columns: 1fr 1fr; gap:14px; align-items:start}
.qa-recite-wrap.is-side-by-side > .card{height: fit-content}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2){height: 100%; display:flex; flex-direction:column}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2) > *:not(.grid-2):not(.hint){flex-shrink:0}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2) .grid-2{flex:1; display:flex; flex-direction:column}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2) .grid-2 > div:first-child{flex:1; display:flex; flex-direction:column}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2) .grid-2 > div:first-child textarea{flex:1; min-height:0}
.qa-recite-wrap.is-side-by-side > .card:nth-child(2) .grid-2 > div:last-child{flex-shrink:0}

.card{
  border:1px solid var(--border);
  background: rgba(18,26,51,.6);
  border-radius:14px;
  padding:14px;
}

.card-header{display:flex; justify-content:space-between; align-items:flex-start; gap:12px}
.player-actions{display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end}

.section-title{font-weight:700; margin:6px 0 10px 0; color:var(--text)}
.divider{height:1px; background:var(--border); margin:12px 0}

.form{display:flex; flex-direction:column; gap:10px}
.field{display:flex; flex-direction:column; gap:6px}
.label{font-size:12px; color:var(--muted)}

.input,.textarea{
  width:100%;
  padding:10px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(15,23,48,.9);
  color:var(--text);
  outline:none;
}

.textarea{resize:vertical; line-height:1.5}

.rt-toolbar{display:flex; gap:6px; flex-wrap:wrap}
.rich-editor{min-height: 140px; white-space:pre-wrap}
.rich-editor:empty:before{content:attr(data-placeholder); color:var(--muted)}
.rich-editor strong{font-weight:800}
.rich-editor mark{background: rgba(255, 204, 102, .25); color: var(--text); padding: 0 2px; border-radius: 4px}

mark[data-color="yellow"]{background: rgba(255, 204, 102, .25); color: var(--text); padding: 0 2px; border-radius: 4px}
mark[data-color="green"]{background: rgba(70, 211, 154, .22); color: var(--text); padding: 0 2px; border-radius: 4px}
mark[data-color="cyan"]{background: rgba(110, 168, 254, .22); color: var(--text); padding: 0 2px; border-radius: 4px}
mark[data-color="magenta"]{background: rgba(216, 112, 214, .22); color: var(--text); padding: 0 2px; border-radius: 4px}

.mark-palette{
  position: fixed;
  z-index: 10000;
  display: flex;
  gap: 6px;
  align-items: center;
  padding: 8px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: rgba(15,23,48,.92);
  backdrop-filter: blur(10px);
  box-shadow: 0 12px 36px rgba(0,0,0,.45);
  user-select: none;
}

.mark-btn{
  width: 30px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.04);
  color: var(--text);
  cursor: pointer;
  font-size: 12px;
  line-height: 1;
}

.mark-btn:hover{filter:brightness(1.05)}
.mark-btn:active{transform:translateY(1px)}

.mark-btn[data-color="yellow"]{background: rgba(255, 204, 102, .18); border-color: rgba(255, 204, 102, .25)}
.mark-btn[data-color="green"]{background: rgba(70, 211, 154, .14); border-color: rgba(70, 211, 154, .22)}
.mark-btn[data-color="cyan"]{background: rgba(110, 168, 254, .14); border-color: rgba(110, 168, 254, .22)}
.mark-btn[data-color="magenta"]{background: rgba(216, 112, 214, .14); border-color: rgba(216, 112, 214, .22)}

.mark-sep{width:1px; height:18px; background: var(--border); margin: 0 2px}

.row{display:flex; gap:8px}
.grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.grid-2{display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:10px}

.btn{
  border:1px solid var(--border);
  background: rgba(15,23,48,.9);
  color:var(--text);
  padding:9px 12px;
  border-radius:10px;
  cursor:pointer;
  user-select:none;
}
.btn:hover{filter:brightness(1.05)}
.btn:active{transform:translateY(1px)}
.btn-primary{background: rgba(110,168,254,.25); border-color: rgba(110,168,254,.35)}
.btn-secondary{background: rgba(255,255,255,.04)}
.btn-danger{background: rgba(255,107,107,.18); border-color: rgba(255,107,107,.35)}

.file-label{position:relative; overflow:hidden}
.file-label input{position:absolute; inset:0; opacity:0; cursor:pointer}

.muted{color:var(--muted); font-size:12px}
.title{font-size:16px; font-weight:700; margin-top:4px}

.qa-list{display:flex; flex-direction:column; gap:8px}
.list-toolbar{display:flex; flex-direction:column; gap:8px; margin-bottom:10px}
.toolbar-row{display:flex; align-items:center; justify-content:space-between; gap:8px}
.input-compact{padding:8px 10px; border-radius:10px}
.page-info{color:var(--muted); font-size:12px; padding:0 6px; white-space:nowrap}

.qa-item{
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
  background: rgba(15,23,48,.7);
  cursor:pointer;
}

.qa-time-hist{
  margin-top:6px;
  font-size:12px;
  color:var(--muted);
  line-height:1.35;
}
.qa-item-row{display:flex; gap:10px; align-items:flex-start}
.qa-check{margin-top:2px}
.qa-item-main{flex:1; min-width:0}
.qa-item.active{outline:2px solid rgba(110,168,254,.35)}
.qa-item .q{font-weight:700; font-size:13px}
.qa-item .a{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.35; max-height:2.7em; overflow:hidden}

.status{
  margin-top:12px;
  padding:10px 12px;
  border:1px dashed rgba(255,255,255,.16);
  border-radius:12px;
  color:var(--muted);
}

.qa-view{display:flex; flex-direction:column; gap:12px; margin-top:12px}
.qa-block{border:1px solid var(--border); background: rgba(15,23,48,.55); border-radius:12px; padding:12px}
.block-title{color:var(--muted); font-size:12px}
.block-body{margin-top:8px; line-height:1.6}

.block-title-row{display:flex; align-items:center; justify-content:space-between; gap:10px}
.mini-actions{display:flex; flex-wrap:wrap; gap:6px; justify-content:flex-end}
.btn-mini{padding:6px 8px; border-radius:9px; font-size:12px}

.answer{margin-top:8px; line-height:1.9}
.sentence{padding:2px 6px; border-radius:8px; display:inline-block; margin:3px 4px 3px 0; border:1px solid transparent}
.sentence.active{border-color: rgba(110,168,254,.5); background: rgba(110,168,254,.12)}
.sentence.hit{border-color: rgba(70,211,154,.55); background: rgba(70,211,154,.12)}
.sentence.miss{border-color: rgba(255,107,107,.45); background: rgba(255,107,107,.08)}

.segment.masked{
  color: rgba(232,236,255,.18);
  border-color: rgba(255,255,255,.06);
  background: rgba(255,255,255,.03);
}
.segment.masked strong{color: rgba(232,236,255,.18)}
.segment.masked mark{background: rgba(255,255,255,.03); color: rgba(232,236,255,.18)}

.card-area{margin-top:10px}
.card-face{
  border:1px solid var(--border);
  background: rgba(15,23,48,.75);
  border-radius:14px;
  padding:14px;
  min-height:86px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  line-height:1.7;
  position:relative;
}
.card-face.masked{color: rgba(232,236,255,.35)}
.card-face.hit{border-color: rgba(70,211,154,.55); background: rgba(70,211,154,.08)}
.card-face.miss{border-color: rgba(255,107,107,.45); background: rgba(255,107,107,.06)}
.card-badge{
  position:absolute;
  top:10px;
  right:10px;
  font-size:12px;
  color: var(--muted);
  border:1px solid var(--border);
  background: rgba(255,255,255,.04);
  padding:4px 8px;
  border-radius:999px;
}

.check{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px}

.summary{margin-top:10px; padding:10px 12px; border:1px solid var(--border); background: rgba(15,23,48,.55); border-radius:12px; line-height:1.6}
.hint{margin-top:10px; color:var(--muted); font-size:12px; line-height:1.6}
.assistant{margin-top:10px; padding:10px 12px; border:1px solid var(--border); background: rgba(15,23,48,.55); border-radius:12px; line-height:1.7; min-height:40px}

.draft-board{margin-top:10px; border:1px solid var(--border); background: rgba(15,23,48,.55); border-radius:12px; padding:10px}
.draft-board-header{display:flex; align-items:center; justify-content:space-between; gap:10px}
.draft-board-actions{display:flex; align-items:center; gap:8px}
.draft-board-actions select{width:auto}
.draft-board-canvas-wrap{margin-top:10px; border:1px solid var(--border); border-radius:12px; overflow:hidden; background: rgba(18,26,51,.35)}
.draft-canvas{display:block; width:100%; height:360px; touch-action:none; cursor:crosshair}

@media (max-width: 980px){
  .layout{grid-template-columns:1fr;}
  .qa-recite-wrap.is-side-by-side{grid-template-columns: 1fr;}
}
